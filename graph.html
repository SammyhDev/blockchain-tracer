<!DOCTYPE html>
<html>
<head>
	<title>Graph!</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<style>
		body {overflow: hidden; background: #040404}

		#ui {position: absolute; top: 2em; left: 0; right: 0; z-index: 1000; opacity: 0.9}

		.card.minimal {padding: 0}
		.card.minimal > * {background: none; padding: 0; margin: 0}
		.card.minimal > * .input-field, .card.minimal * > .range-field {margin: 0}
		.card.minimal > * .input-field > input, .card.minimal > * .input-field > .select-wrapper > input {margin-bottom: 0; border-bottom: 0}
		.card.minimal > * .range-field > input {margin-top: 1.25em}
		.card.minimal > * .btn {height: 100%; transform: scale(1.5)}
		.card.minimal > * .range-field > label, .card.minimal > * .switch > label {position: absolute; top: -2em}

		#canvas {overflow: visible !important}

		#tooltip {
			position: absolute;
			opacity: 0;
			pointer-events: none;
		}

		.dropdown-content {width: fit-content !important; height: auto !important; margin-top: 3em}
		#toast-container {top: auto; bottom: 2%; left: 0; right: 0; margin: auto; max-width: fit-content}
	</style>
</head>
<body>
	<div id="ui" class="container row">
		<div class="card minimal col s5">
			<div class="card-action row">
				<form onsubmit="event.preventDefault(); trace(this[0].value)">
					<div class="input-field col s10">
						<input placeholder="Address/Transaction Hash" id="hash" type="text" value="1AJbsFZ64EpEfS5UAjAfcUG8pH8Jn3rn1F">
					</div>
					<button class="btn waves-effect waves-light col s2" type="submit" name="action"><i class="material-icons">arrow_forward</i></button>
				</form>
			</div>
		</div>

		<div class="col s1"></div>

		<div class="card minimal col s5">
			<div class="card-action row">
				<div class="input-field col s2">
					<select onchange="updateFillStyle(parseInt(this.value))">
						<option value="0">Distance</option>
						<option value="1">Mono</option>
						<option value="2">Poison</option>
						<option value="3" disabled>Haircut</option>
						<option value="4" disabled>FIFO</option>
						<option value="5" disabled>FILO</option>
					</select>
					<label style="position: absolute; top: -3em; font-size: 0.8em">Colouring</label>
				</div>

				<div class="input-field col s3">
					<input type="text" class="datepicker" value="2000/01/01" onchange="dateMin = new Date(this.value).getTime()/1000">
					<label style="position: absolute; top: -0.6em">From</label>
				</div>

				<div class="input-field col s3">
					<input type="text" class="datepicker" value="3000/01/01" onchange="dateMax = new Date(this.value).getTime()/1000">
					<label style="position: absolute; top: -0.6em">To</label>
				</div>

				<div class="switch col s2">
					<label>
						Invert<br/><br/>
						<input type="checkbox" checked onchange="document.getElementsByTagName('body')[0].style.background = !this.checked ? 'white' : 'black'" />
						<span class="lever"></span>
					</label>
				</div>

				<div class="switch col s2">
					<label>
						Simulation<br/><br/>
						<input type="checkbox" checked onchange="this.checked ? simulation.velocityDecay(0.92) : simulation.velocityDecay(1)" />
						<span class="lever"></span>
					</label>
				</div>
			</div>
		</div>
		<!-- Dropdown Trigger -->
		<a class='dropdown-trigger btn-flat col s1' href='#' data-target='dropdown'><i class="material-icons" style="color: #aaa; font-size: 3em; margin-top: 0.3em">more_vert</i></a>
	</div>

	<svg id="canvas"></svg>

	<div id="tooltip" class="card">
		<div class="card-content">
			<p id="tooltip-title">Unknown</p>
			<p id="tooltip-value">Unknown</p>
		</div>
		<div class="card-tabs">
			<ul class="tabs tabs-fixed-width">
				<li class="tab"><a href="#tooltip-all" class="active"><span id="tooltip-allcount"></span> Total</a></li>
				<li class="tab"><a href="#tooltip-in"><span id="tooltip-incount"></span> Incoming</a></li>
				<li class="tab"><a href="#tooltip-out"><span id="tooltip-outcount"></span> Outgoing</a></li>
			</ul>
		</div>
		<div class="card-content grey lighten-4">
			<!-- <div id="tooltip-all"></div> -->
			<div id="tooltip-in"></div>
			<div id="tooltip-out"></div>
		</div>
	</div>

	<!-- Dropdown Structure -->
	<ul id='dropdown' class='dropdown-content'>
		<li><a href="javascript:copyToClipboard(window.location); M.toast({html: 'Copied to Clipboard'})">Share<i class="material-icons left">share</i></a></li>
		<li><a href="javascript:saveSvg(document.getElementById('canvas'), 'graph.svg')">Graph<i class="material-icons left">file_download</i></a></li>
		<li><a href="javascript:saveText(JSON.stringify([nodes, links]), 'data.json');">Data<i class="material-icons left">file_download</i></a></li>
		<li class="divider" tabindex="-1"></li>
		<li><a href="https://consto.uk/blockchain-tracer/report.pdf" target="_blank">Report<i class="material-icons left">launch</i></a></li>
		<li><a href="#modal-help" class="modal-trigger">Help<i class="material-icons left">help_outline</i></a></li>
		<li><a href="#modal-about" class="modal-trigger">About<i class="material-icons left">info_outline</i></a></li>
		<li class="divider" tabindex="-1"></li>
		<li><a href="#">Close<i class="material-icons left">close</i></a></li>
	</ul>

	<div id="modal-help" class="modal">
		<div class="modal-content">
		<h4>Help</h4>
		<ul class="browser-default" style="padding-left: 1.5em">
			<li>Hover over noes to see their address, click on them to explore the blockchain.</li>
			<li>Use your mouse to pan and zoom around the graph.</li>
			<li>Have fun!</li>
		</ul>
		</div>
		<div class="modal-footer">
			<a href="#!" class="modal-close waves-effect waves-green btn-flat">Close</a>
		</div>
	</div>

	<div id="modal-about" class="modal">
		<div class="modal-content">
		<h4>About</h4>
		<p>Created by <a href="https://consto.uk">Matthew Consterdine</a>, Dennis Parkchov, and Altay Adademir for Computational Finance at the <a href="https://southampton.ac.uk">University of Southampton</a>.</p>
		<p>Powered by <a href="https://blockchain.info">Blockchain.info and <a href="https://d3js.org">D3.js</a>.</p>
		</div>
		<div class="modal-footer">
			<a href="#!" class="modal-close waves-effect waves-green btn-flat">Close</a>
		</div>
	</div>
</body>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>
	<script src="graph.js"></script>
	<script src="blockchain.js"></script>
	<script src="tags.json"></script>
	<script src="init.js"></script>
</html>
